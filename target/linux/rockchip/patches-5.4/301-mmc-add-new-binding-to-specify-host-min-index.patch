From 659b50d846a18a4999026e01fd10c2129d7a56db Mon Sep 17 00:00:00 2001
From: jensen <jensenhuang@friendlyarm.com>
Date: Mon, 24 Aug 2020 20:07:11 +0800
Subject: [PATCH] mmc: add new binding to specify host min index

Signed-off-by: jensen <jensenhuang@friendlyarm.com>
---
 drivers/mmc/core/host.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/drivers/mmc/core/host.c b/drivers/mmc/core/host.c
index b3484def0a8b..9cb982bc2349 100644
--- a/drivers/mmc/core/host.c
+++ b/drivers/mmc/core/host.c
@@ -397,6 +397,7 @@ struct mmc_host *mmc_alloc_host(int extra, struct device *dev)
 {
 	int err;
 	struct mmc_host *host;
+	u32 index_min = 0;
 
 	host = kzalloc(sizeof(struct mmc_host) + extra, GFP_KERNEL);
 	if (!host)
@@ -405,7 +406,11 @@ struct mmc_host *mmc_alloc_host(int extra, struct device *dev)
 	/* scanning will be enabled when we're ready */
 	host->rescan_disable = 1;
 
-	err = ida_simple_get(&mmc_host_ida, 0, 0, GFP_KERNEL);
+	device_property_read_u32(dev, "host-index-min", &index_min);
+	if (index_min > 0)
+		dev_dbg(dev, "alloc index from %d\n", index_min);
+
+	err = ida_simple_get(&mmc_host_ida, index_min, 0, GFP_KERNEL);
 	if (err < 0) {
 		kfree(host);
 		return NULL;
-- 
2.25.1

